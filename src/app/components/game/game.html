<div class="game-wrapper">
  <div class="header" *ngIf="gameService.connectionStatus() === 'MATCHED'">
    <span>‚è± {{ gameService.gameTimer() }}s</span>
    <span>üí¨ {{ gameService.messageCount() }}/10</span>
  </div>

  <div class="chat-area" #scrollContainer>
    @for (msg of gameService.messages(); track msg.timestamp) {
      <div [class]="msg.sender === 'system' ? 'system-msg' : 'msg-row ' + (msg.sender === 'me' ? 'me' : 'them')">
        @if (msg.sender === 'opponent') {
          <img [src]="gameService.opponentAvatarUrl()" class="avatar">
        }
        
        <div class="bubble">
          {{ msg.text }}
          <small>{{ msg.timestamp | date:'shortTime' }}</small>
        </div>

        @if (msg.sender === 'me') {
          <img [src]="gameService.myAvatarUrl()" class="avatar">
        }
      </div>
    }
  </div>

  <div class="input-bar" *ngIf="!gameService.isGameOver()">
    <input #chatInput [(ngModel)]="messageInput" (keyup.enter)="handleSendMessage()" placeholder="Expose the bot...">
    <button (click)="handleSendMessage()" [disabled]="!messageInput.trim()">Send</button>
  </div>

  <div class="overlay" *ngIf="gameService.isGameOver() && !gameResult()">
    <div class="modal">
      <h2>Interrogation Over</h2>
      <p>Cast your verdict. Who were you talking to?</p>
      <div class="btn-group" *ngIf="!isRevealing()">
        <button class="human" (click)="selectIdentity('Human')">BIOLOGICAL HUMAN</button>
        <button class="bot" (click)="selectIdentity('AI')">AI MODEL</button>
      </div>
      <p *ngIf="isRevealing()" class="loading">Analyzing neural patterns...</p>
    </div>
  </div>

  <div class="overlay" *ngIf="gameResult()">
    <div class="modal result">
      <h1 [class.correct]="gameResult().correct">
        {{ gameResult().correct ? 'SUCCESS!' : 'FAILED!' }}
      </h1>
      <p>The entity was actually a <strong>{{ gameResult().actualRole }}</strong>.</p>
      <button class="primary-btn" (click)="gameService.leaveGame()">RETURN TO LOBBY</button>
    </div>
  </div>
</div>